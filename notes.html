<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>Founder OS</title>

    <!-- PWA -->
    <link rel="manifest" href="manifest.json" />
    <meta name="theme-color" content="#0f172a" />

    <!-- Basic styling (temporary) -->
    <style>
      body {
        margin: 0;
        font-family: system-ui, sans-serif;
        background: #0f172a;
        color: white;
      }

      nav {
        display: flex;
        gap: 12px;
        padding: 12px;
        background: #020617;
      }

      nav a {
        color: white;
        text-decoration: none;
        font-size: 14px;
      }
    </style>
  </head>
  <body>
    <!-- Navigation (top of body) -->
    <nav>
      <a href="index.html">Dashboard</a>
      <a href="track.html">Track</a>
      <a href="tasks.html">Tasks</a>
      <a href="notes.html">Notes</a>
      <a href="progress.html">Progress</a>
    </nav>
    <main>
      <!-- AUTH BOX -->
      <div id="authBox" style="display: none; margin-bottom: 12px">
        <input id="authEmail" type="email" placeholder="Email" />
        <input id="authPassword" type="password" placeholder="Password" />
        <button onclick="handleAuth()">Sign in / Create account</button>
      </div>

      <!-- rest of page content -->

      <!-- Page-specific content -->

      <h1>Notes</h1>
      <!-- Page UI goes here -->
    </main>
    <!-- Firebase + Firestore -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
      import {
        getFirestore,
        enableIndexedDbPersistence,
      } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
      import {
        getAuth,
        onAuthStateChanged,
        EmailAuthProvider,
        linkWithCredential,
        signInWithEmailAndPassword,
        signInAnonymously,
      } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

      const firebaseConfig = {
        apiKey: "YOUR_KEY",
        authDomain: "YOUR_PROJECT.firebaseapp.com",
        projectId: "YOUR_PROJECT",
        storageBucket: "YOUR_PROJECT.appspot.com",
        messagingSenderId: "XXXX",
        appId: "XXXX",
      };

      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);
      const auth = getAuth(app);

      enableIndexedDbPersistence(db).catch(() => {
        console.log("Offline persistence unavailable");
      });

      // Anonymous sign-in
      signInAnonymously(auth).catch(console.error);

      onAuthStateChanged(auth, (user) => {
        if (!user) return;

        if (user.isAnonymous) {
          authBox.style.display = "block";
        } else {
          authBox.style.display = "none";
        }

        // loadNotes(); // stub for now
      });

      window.handleAuth = async function () {
        const email = authEmail.value.trim();
        const password = authPassword.value;

        if (!email || !password) {
          alert("Enter email and password");
          return;
        }

        try {
          const credential = EmailAuthProvider.credential(email, password);

          if (auth.currentUser.isAnonymous) {
            await linkWithCredential(auth.currentUser, credential);
            alert("Account linked successfully.");
          } else {
            await signInWithEmailAndPassword(auth, email, password);
          }
        } catch (err) {
          if (err.code === "auth/email-already-in-use") {
            await signInWithEmailAndPassword(auth, email, password);
          } else {
            alert(err.message);
          }
        }
      };

      window.db = db;
      window.auth = auth;
    </script>

    <script>
      if ("serviceWorker" in navigator) {
        navigator.serviceWorker.register("sw.js");
      }
    </script>
  </body>
</html>
