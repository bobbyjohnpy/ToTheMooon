<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tasks â€“ Founder OS</title>

    <link rel="manifest" href="manifest.json" />
    <meta name="theme-color" content="#0f172a" />

    <style>
      :root {
        --bg-page: #0f172a;
        --bg-card: #020617;
        --bg-note: #020b1f;

        --text-primary: #e5e7eb;
        --text-secondary: #94a3b8;
        --text-muted: #64748b;

        --border-subtle: rgba(255, 255, 255, 0.06);

        --urgency-high: #ef4444;
        --urgency-medium: #f59e0b;
        --urgency-low: #22c55e;
      }

      /* â”€â”€â”€â”€â”€â”€â”€â”€â”€ Base Layout â”€â”€â”€â”€â”€â”€â”€â”€â”€ */

      body {
        margin: 0;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
        background: var(--bg-page);
        color: var(--text-primary);
      }

      nav {
        display: flex;
        justify-content: space-around;
        padding: 12px;
        background: #020617;
        position: sticky;
        top: 0;
        z-index: 10;
      }

      nav a {
        color: var(--text-secondary);
        text-decoration: none;
        font-size: 14px;
      }

      nav a:hover {
        color: var(--text-primary);
      }
      .page-wrapper {
        display: flex;
        justify-content: center;
        width: 100%;
      }
      main {
        width: 80%;
        padding: 16px;
        max-width: 720px;
        margin: 0 auto;
        display: flex;
        flex-direction: column;
      }

      h1 {
        margin-top: 0;
        font-size: 20px;
        font-weight: 600;
      }

      /* â”€â”€â”€â”€â”€â”€â”€â”€â”€ Inputs (Add Task Area) â”€â”€â”€â”€â”€â”€â”€â”€â”€ */

      input,
      select,
      textarea {
        width: 100%;
        padding: 10px 0px;
        margin-top: 6px;
        border-radius: 8px;
        border: none;
        font-size: 14px;
        background: #020617;
        color: var(--text-primary);
      }

      textarea {
        resize: vertical;
      }

      button {
        margin-top: 8px;
        background: #2563eb;
        color: white;
        border: none;
        padding: 10px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
      }

      /* â”€â”€â”€â”€â”€â”€â”€â”€â”€ Task Card â”€â”€â”€â”€â”€â”€â”€â”€â”€ */

      .task-card {
        background: var(--bg-card);
        border-radius: 10px;
        padding: 12px 14px;
        margin-bottom: 10px;

        display: flex;
        flex-direction: column;
        gap: 6px;
      }
      .add-task {
        display: flex;
        flex-direction: column;
      }
      /* Urgency accent (ONLY visual urgency) */
      .task-card.high {
        border-left: 3px solid var(--urgency-high);
      }
      .task-card.medium {
        border-left: 3px solid var(--urgency-medium);
      }
      .task-card.low {
        border-left: 3px solid var(--urgency-low);
      }

      /* â”€â”€â”€â”€â”€â”€â”€â”€â”€ Task Header â”€â”€â”€â”€â”€â”€â”€â”€â”€ */

      .task-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .task-title {
        font-size: 14px;
        font-weight: 500;
        color: var(--text-primary);
      }

      .urgency-badge {
        font-size: 11px;
        padding: 2px 8px;
        border-radius: 999px;
        background: rgba(255, 255, 255, 0.06);
        color: var(--text-secondary);
        text-transform: capitalize;
      }

      /* â”€â”€â”€â”€â”€â”€â”€â”€â”€ Meta â”€â”€â”€â”€â”€â”€â”€â”€â”€ */

      .task-meta {
        font-size: 11px;
        color: var(--text-muted);
      }
      #authPanel {
        display: flex;
        flex-direction: column;
        width: 100%;
      }
      /* â”€â”€â”€â”€â”€â”€â”€â”€â”€ Notes â”€â”€â”€â”€â”€â”€â”€â”€â”€ */

      .task-notes {
        display: flex;
        flex-direction: column;
        gap: 6px;
      }

      .note {
        background: var(--bg-note);
        padding: 6px 8px;
        border-radius: 6px;
        font-size: 12px;
        color: var(--text-primary);
      }

      .note small {
        display: block;
        margin-top: 2px;
        font-size: 10px;
        color: var(--text-muted);
      }

      /* â”€â”€â”€â”€â”€â”€â”€â”€â”€ Subtasks â”€â”€â”€â”€â”€â”€â”€â”€â”€ */

      .subtasks {
        margin-top: 4px;
      }

      .subtasks ul {
        list-style: none;
        padding: 0;
        margin: 0;
      }

      .subtasks li {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 12px;
        color: var(--text-primary);
      }

      .subtasks li.done span {
        text-decoration: line-through;
        color: var(--text-muted);
      }

      .subtask-input {
        margin-top: 4px;
        background: transparent;
        border: none;
        border-bottom: 1px solid var(--border-subtle);
        padding: 4px 0;
        font-size: 12px;
        color: var(--text-primary);
      }

      /* â”€â”€â”€â”€â”€â”€â”€â”€â”€ Actions (INLINE, NOT BUTTONS) â”€â”€â”€â”€â”€â”€â”€â”€â”€ */

      .task-actions {
        display: flex;
        gap: 12px;
        font-size: 12px;
      }

      .task-actions span {
        cursor: pointer;
        color: var(--text-secondary);
      }

      .task-actions span:hover {
        color: var(--text-primary);
      }
      /* â”€â”€â”€â”€â”€â”€â”€â”€â”€ Mobile Refinements â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
      @media (max-width: 600px) {
        main {
          padding: 12px;
          width: 85%;
          margin: 0;
        }
        .addtask-button {
          margin-bottom: 10px;
        }
        h1 {
          font-size: 18px;
        }

        /* Task Card tightening */
        .task-card {
          padding: 10px 12px;
          gap: 5px;
        }

        .task-title {
          font-size: 13px;
          line-height: 1.3;
        }

        .urgency-badge {
          font-size: 10px;
          padding: 2px 6px;
        }

        .task-meta {
          font-size: 10px;
        }

        /* Notes: more compact */
        .note {
          font-size: 11px;
          padding: 5px 6px;
        }

        .note small {
          font-size: 9px;
        }

        /* Inputs feel lighter */
        input,
        select,
        textarea {
          padding: 10px 0px;
          font-size: 13px;
        }

        textarea {
          min-height: 48px;
        }

        /* Subtasks tighter */
        .subtasks li {
          font-size: 11px;
          gap: 6px;
        }

        .subtask-input {
          font-size: 11px;
        }

        /* Inline actions easier to tap (without buttons) */
        .task-actions span {
          padding: 4px 0;
        }

        /* Nav readability */
        nav a {
          font-size: 13px;
        }
      }
    </style>
  </head>

  <body>
    <nav>
      <a href="index.html">Dashboard</a>
      <a href="track.html">Track</a>
      <a href="tasks.html">Tasks</a>
      <a href="notes.html">Notes</a>
      <a href="progress.html">Progress</a>
    </nav>
    <div class="page-wrapper">
      <!-- AUTH BOX -->

      <!--    
  <div id="authBox" style="display:none; margin-bottom:12px;">
    <input id="authEmail" type="email" placeholder="Email" />
    <input id="authPassword" type="password" placeholder="Password" />
    <button onclick="handleAuth()">Sign in / Create account</button>
  </div> -->

      <!-- rest of page content -->

      <main>
        <h1>Tasks</h1>
        <div id="authPanel" style="display: none; margin-bottom: 16px">
          <div class="card">
            <small class="small">Account</small>

            <input id="authEmail" type="email" placeholder="Email" />
            <input id="authPassword" type="password" placeholder="Password" />

            <div style="display: flex; gap: 12px; margin-top: 8px">
              <span onclick="linkAccount()" style="cursor: pointer"
                >Create Account</span
              >
              <span onclick="signIn()" style="cursor: pointer">Sign In</span>
            </div>
          </div>
        </div>

        <!-- ADD TASK -->
        <div class="add-task">
          <input id="taskTitle" placeholder="Task name" />

          <select id="taskUrgency">
            <option value="high">ğŸ”¥ High</option>
            <option value="medium">âš ï¸ Medium</option>
            <option value="low">ğŸŸ¢ Low</option>
          </select>

          <textarea
            id="taskNote"
            placeholder="Initial note (optional)"
          ></textarea>

          <button class="addtask-button" onclick="addTask()">Add Task</button>
        </div>

        <!-- TASK LIST -->
        <div id="taskList"></div>
      </main>
    </div>
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
      import {
        getFirestore,
        collection,
        addDoc,
        onSnapshot,
        query,
        orderBy,
        doc,
        getDoc,
        deleteDoc,
        updateDoc,
        arrayUnion,
      } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
      import {
        getAuth,
        signInAnonymously,
        onAuthStateChanged,
      } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
      import {
        EmailAuthProvider,
        linkWithCredential,
        signInWithEmailAndPassword,
        createUserWithEmailAndPassword,
      } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

      const firebaseConfig = {
        apiKey: "AIzaSyDoFnzTnVlvebTeHly2tzkaV9tz-OxNvnw",
        authDomain: "tothemoon100percent.firebaseapp.com",
        projectId: "tothemoon100percent",
        storageBucket: "tothemoon100percent.firebasestorage.app",
        messagingSenderId: "1084909945870",
        appId: "1:1084909945870:web:4c29fb6da7d251daf4e85f",
      };

      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);
      const auth = getAuth(app);
      window._auth = auth;

      let uid = null;

      signInAnonymously(auth);

      onAuthStateChanged(auth, (user) => {
        if (user) {
          uid = user.uid;
          loadTasks();

          if (user.isAnonymous) {
            document.getElementById("authPanel").style.display = "flex";
          } else {
            document.getElementById("authPanel").style.display = "none";
          }
        }
      });

      window.handleAuth = async function () {
        const email = authEmail.value.trim();
        const password = authPassword.value;

        if (!email || !password) {
          alert("Enter email and password");
          return;
        }

        try {
          const credential = EmailAuthProvider.credential(email, password);

          if (auth.currentUser.isAnonymous) {
            await linkWithCredential(auth.currentUser, credential);
            alert("Account created. Your data is now synced.");
          } else {
            await signInWithEmailAndPassword(auth, email, password);
          }
        } catch (err) {
          if (err.code === "auth/email-already-in-use") {
            await signInWithEmailAndPassword(auth, email, password);
          } else {
            alert(err.message);
          }
        }
      };

      window.linkAccount = async function () {
        const email = document.getElementById("authEmail").value.trim();
        const password = document.getElementById("authPassword").value;

        if (!email || !password) {
          alert("Enter email and password");
          return;
        }

        try {
          const credential = EmailAuthProvider.credential(email, password);
          await linkWithCredential(auth.currentUser, credential);
          alert("Account created. Your data is now synced.");
        } catch (err) {
          alert(err.message);
        }
      };
      window.signIn = async function () {
        const email = document.getElementById("authEmail").value.trim();
        const password = document.getElementById("authPassword").value;

        if (!email || !password) {
          alert("Enter email and password");
          return;
        }

        try {
          await signInWithEmailAndPassword(auth, email, password);
          document.getElementById("authPanel").style.display = "none";
        } catch (err) {
          alert(err.message);
        }
      };

      // ADD TASK
      window.addTask = async function () {
        const title = taskTitle.value.trim();
        const urgency = taskUrgency.value;
        const noteText = taskNote.value.trim();

        if (!title) return alert("Task needs a name");

        const task = {
          title,
          urgency,
          notes: noteText ? [{ text: noteText, date: Date.now() }] : [],
          createdAt: Date.now(),
          completed: false,
          completedAt: null,
        };

        await addDoc(collection(db, "users", uid, "tasks"), task);

        taskTitle.value = "";
        taskNote.value = "";
      };

      // LOAD + RENDER TASKS
      function loadTasks() {
        const q = query(
          collection(db, "users", uid, "tasks"),
          orderBy("completed"),
          orderBy("createdAt", "desc")
        );

        onSnapshot(q, (snap) => {
          const list = document.getElementById("taskList");
          list.innerHTML = "";

          snap.forEach((docSnap) => {
            const task = docSnap.data();
            const el = renderTask(docSnap.id, task);
            list.appendChild(el);
          });
        });
      }

      // TASK CARD
      function renderTask(id, task) {
        const div = document.createElement("div");
        div.className = `task-card ${task.urgency}`;

        div.innerHTML = `
    <div class="task-header">
      <div class="task-title">${task.title}</div>
      <div class="urgency-badge">${task.urgency}</div>
    </div>

    <div class="task-meta">
      Created ${new Date(task.createdAt).toLocaleDateString()}
    </div>

    <div class="task-notes">
      ${task.notes
        .map(
          (n) => `
        <div class="note">
          ${n.text}
          <small>${new Date(n.date).toLocaleString()}</small>
        </div>
      `
        )
        .join("")}
    </div>

    <textarea
      placeholder="Add note and press Enter"
      onkeydown="addNote(event, '${id}')"
    ></textarea>

    <div class="subtasks">
      <ul>
        ${(task.subtasks || [])
          .map(
            (s, i) => `
          <li class="${s.completed ? "done" : ""}">
               <span>${s.text}</span>
            <input
              type="checkbox"
              ${s.completed ? "checked" : ""}
              onchange="toggleSubtask('${id}', ${i}, ${s.completed})"
            />
         
          </li>
        `
          )
          .join("")}
      </ul>

      <input
        class="subtask-input"
        placeholder="Add subtask and press Enter"
        onkeydown="addSubtask(event, '${id}')"
      />
    </div>

    <div class="task-actions">
      ${
        task.completed
          ? `<span style="color: var(--urgency-low)">Completed</span>`
          : `<span onclick="completeTask('${id}')">Complete</span>`
      }
      <span onclick="deleteTask('${id}')">Delete</span>
    </div>
  `;

        return div;
      }

      // ADD NOTE
      window.addNote = async function (e, taskId) {
        if (e.key !== "Enter") return;

        const text = e.target.value.trim();
        if (!text) return;

        e.target.value = "";

        await updateDoc(doc(db, "users", uid, "tasks", taskId), {
          notes: arrayUnion({ text, date: Date.now() }),
        });
      };

      // COMPLETE TASK
      window.completeTask = async function (taskId) {
        await updateDoc(doc(db, "users", uid, "tasks", taskId), {
          completed: true,
          completedAt: Date.now(),
        });
      };

      // DELETE TASK
      window.deleteTask = async function (taskId) {
        await deleteDoc(doc(db, "users", uid, "tasks", taskId));
      };

      window.addSubtask = async function (e, taskId) {
        if (e.key !== "Enter") return;

        const text = e.target.value.trim();
        if (!text) return;

        e.target.value = "";

        await updateDoc(doc(db, "users", uid, "tasks", taskId), {
          subtasks: arrayUnion({ text, completed: false }),
        });
      };

      window.toggleSubtask = async function (taskId, index, current) {
        const ref = doc(db, "users", uid, "tasks", taskId);

        const snap = await getDoc(ref);
        const task = snap.data();

        task.subtasks[index].completed = !current;

        await updateDoc(ref, {
          subtasks: task.subtasks,
        });
      };
    </script>

    <script>
      if ("serviceWorker" in navigator) {
        navigator.serviceWorker.register("sw.js");
      }
    </script>
  </body>
</html>
